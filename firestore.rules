rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ========================================
    // FONCTION HELPER - Vérifie si l'utilisateur est authentifié
    // Utilise l'auth anonyme Firebase activée dans app.js
    // ========================================
    function isAuthenticated() {
      return request.auth != null;
    }

    // ========================================
    // RÈGLE TEMPORAIRE - En attendant activation Auth Anonyme
    // TODO: Supprimer cette règle après avoir activé Auth Anonyme
    // dans Firebase Console > Authentication > Sign-in method > Anonymous
    // ========================================

    // DONNÉES JOUEUSES
    match /players/{playerId} {
      allow read, write: if true; // TEMPORAIRE - remplacer par: if isAuthenticated();
      match /testSessions/{sessionId} {
        allow read, write: if true;
      }
      match /stats/{statType} {
        allow read, write: if true;
      }
    }

    // SUIVI QUOTIDIEN RPE
    match /checkins/{checkinId} {
      allow read, write: if true;
    }
    match /rpe/{rpeId} {
      allow read, write: if true;
    }
    match /rpe_data/{rpeDataId} {
      allow read, write: if true;
    }
    match /rpeHistory/{rpeHistoryId} {
      allow read, write: if true;
    }

    // PÉRIODES DE REPOS
    match /rest_periods/{periodId} {
      allow read, write: if true;
    }
    match /restPeriods/{periodId} {
      allow read, write: if true;
    }

    // CYCLE MENSTRUEL
    match /menstrualCycle/{playerId} {
      allow read, write: if true;
    }
    match /dailySymptoms/{symptomId} {
      allow read, write: if true;
    }
    match /cycleProfiles/{playerId} {
      allow read, write: if true;
    }
    match /trainingRecommendations/{recommendationId} {
      allow read, write: if true;
    }
    match /trainingRecommendationsHistory/{recommendationId} {
      allow read, write: if true;
    }

    // ALERTES SANTÉ
    match /healthAlerts/{alertId} {
      allow read, write: if true;
    }
    match /injuries/{injuryId} {
      allow read, write: if true;
    }
    match /pains/{painId} {
      allow read, write: if true;
    }

    // COMMUNICATION
    match /urgent_messages/{messageId} {
      allow read, write: if true;
    }
    match /notifications/{notificationId} {
      allow read, write: if true;
    }
    match /fcmTokens/{tokenId} {
      allow read, write: if true;
    }

    // PLANNING
    match /schedules/{userId} {
      allow read, write: if true;
      match /days/{dateKey} {
        allow read, write: if true;
      }
    }
  }
}
