<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>V√©rification Cycle Charlotte</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>V√©rification Cycle Charlotte</h1>
    <div id="results"></div>

    <script type="module">
        // Configuration Firebase de production
        const firebaseConfig = {
            apiKey: "AIzaSyAA4h5uwMKz7rJ1GtAQCfGxuygcuXuSTLU",
            authDomain: "rpe-volleyball-sable.firebaseapp.com",
            projectId: "rpe-volleyball-sable",
            storageBucket: "rpe-volleyball-sable.firebasestorage.app",
            messagingSenderId: "691799022795",
            appId: "1:691799022795:web:f1aa3a9a8e8e2f50b36a40"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const resultsDiv = document.getElementById('results');

        async function checkCharlotteCycle() {
            const playerId = 'Charlotte';
            let html = '<h2>üìä Donn√©es de Charlotte</h2>';

            try {
                // 1. Configuration du cycle (menstrualCycle)
                html += '<h3>1Ô∏è‚É£ Collection menstrualCycle</h3>';
                const cycleDoc = await db.collection('menstrualCycle').doc(playerId).get();
                if (cycleDoc.exists) {
                    const data = cycleDoc.data();
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    
                    // Calculer le jour du cycle
                    if (data.cycleStartDate) {
                        const startDate = new Date(data.cycleStartDate);
                        const today = new Date();
                        const diffTime = today - startDate;
                        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                        const dayOfCycle = diffDays + 1;
                        html += `<p><strong>üî¥ Dernier d√©but de cycle:</strong> ${data.cycleStartDate}</p>`;
                        html += `<p><strong>üìÖ Jours √©coul√©s:</strong> ${diffDays} jours</p>`;
                        html += `<p><strong>üéØ Jour du cycle actuel:</strong> J${dayOfCycle}</p>`;
                    }
                } else {
                    html += '<p>‚ùå Aucune configuration trouv√©e</p>';
                }

                // 2. Profil complet (cycleProfiles)
                html += '<h3>2Ô∏è‚É£ Collection cycleProfiles</h3>';
                const profileDoc = await db.collection('cycleProfiles').doc(playerId).get();
                if (profileDoc.exists) {
                    const data = profileDoc.data();
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    html += '<p>‚ùå Aucun profil trouv√©</p>';
                }

                // 3. Derniers check-ins avec r√®gles
                html += '<h3>3Ô∏è‚É£ Derniers check-ins avec r√®gles (hasPeriod = true)</h3>';
                const checkinsSnapshot = await db.collection('checkins')
                    .where('playerId', '==', playerId)
                    .where('hasPeriod', '==', true)
                    .orderBy('date', 'desc')
                    .limit(5)
                    .get();
                
                if (!checkinsSnapshot.empty) {
                    html += '<ul>';
                    checkinsSnapshot.forEach(doc => {
                        const data = doc.data();
                        html += `<li><strong>${data.date}</strong> - R√®gles: ${data.hasPeriod ? '‚úÖ Oui' : '‚ùå Non'}</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p>‚ùå Aucun check-in avec r√®gles trouv√©</p>';
                }

                // 4. Tous les derniers check-ins (avec ou sans r√®gles)
                html += '<h3>4Ô∏è‚É£ Tous les derniers check-ins (10 derniers)</h3>';
                const allCheckinsSnapshot = await db.collection('checkins')
                    .where('playerId', '==', playerId)
                    .orderBy('date', 'desc')
                    .limit(10)
                    .get();
                
                if (!allCheckinsSnapshot.empty) {
                    html += '<table border="1" cellpadding="5" style="border-collapse: collapse;">';
                    html += '<tr><th>Date</th><th>R√®gles</th><th>√ânergie</th><th>Douleurs</th></tr>';
                    allCheckinsSnapshot.forEach(doc => {
                        const data = doc.data();
                        const hasPeriod = data.hasPeriod === true ? 'üî¥ Oui' : (data.hasPeriod === false ? '‚ö™ Non' : '‚ùì Non renseign√©');
                        html += `<tr>
                            <td>${data.date}</td>
                            <td>${hasPeriod}</td>
                            <td>${data.energy || '-'}</td>
                            <td>${data.pelvicPain || '-'}</td>
                        </tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>‚ùå Aucun check-in trouv√©</p>';
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = '<p style="color: red;">‚ùå Erreur: ' + error.message + '</p>';
                console.error('Erreur:', error);
            }
        }

        // Lancer la v√©rification
        checkCharlotteCycle();
    </script>
</body>
</html>
